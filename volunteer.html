<!doctype html> <html lang="en"> <head> <meta charset="utf-8" /> <title>Volunteer Signup Board</title> <meta name="viewport" content="width=device-width, initial-scale=1" /> <style> :root{ --bg:#f5f7fb; --panel:#e9eef6; --card:#ffffff; --text:#1a1a1a; --muted:#6b7280; --accent:#0052cc; /* deep blue for strong contrast on white */ --accent-contrast:#ffffff; --danger:#b00020; --ok:#0f7b0f; --shadow:0 2px 6px rgba(16,24,40,.08), 0 1px 2px rgba(16,24,40,.08); --radius:12px; } *{box-sizing:border-box} html,body{height:100%} body{ margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Helvetica Neue", Helvetica, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol; background:var(--bg); color:var(--text); line-height:1.4; }
/* Sticky header */
.app-header{
  position:sticky; top:0; z-index:1000;
  background:linear-gradient(180deg, #fff, #fff0), var(--card);
  border-bottom:1px solid #d8dfeb;
  padding:.75rem 1rem;
  display:flex; align-items:center; gap:.75rem; justify-content:space-between;
}
.brand{display:flex; align-items:center; gap:.5rem; font-weight:700; letter-spacing:.2px;}
.brand .dot{width:10px; height:10px; border-radius:50%; background:var(--accent)}
.header-actions{display:flex; align-items:center; gap:.5rem}
.btn{
  display:inline-flex; align-items:center; gap:.5rem; justify-content:center;
  background:var(--accent); color:var(--accent-contrast);
  border:none; border-radius:10px; padding:.55rem .8rem; font-weight:600; cursor:pointer;
  box-shadow:var(--shadow);
}
.btn.secondary{background:#eef2fa; color:#0f172a; box-shadow:none; border:1px solid #d8dfeb}
.btn.link{background:transparent; border:none; color:var(--accent); padding:.25rem .5rem}
.btn:focus-visible{outline:3px solid #1f7aff; outline-offset:2px}
.btn[disabled], .btn[aria-disabled="true"]{opacity:.65; cursor:not-allowed}

/* Board layout */
.board-wrap{padding:1rem; overflow:auto;}
.board{
  display:flex; gap:1rem; align-items:flex-start;
  min-height:calc(100vh - 120px);
}
.list{
  width:300px; min-width:300px; background:var(--panel);
  border:1px solid #d8dfeb; border-radius:var(--radius);
  box-shadow:var(--shadow);
  display:flex; flex-direction:column; max-height:calc(100vh - 170px);
}
.list-header{
  padding:.75rem .75rem .5rem; display:flex; flex-direction:column; gap:.5rem;
  position:sticky; top:0; background:linear-gradient(180deg, var(--panel), #0000 90%);
  z-index:1; border-top-left-radius:var(--radius); border-top-right-radius:var(--radius);
}
.list-title{font-weight:700; font-size:1rem; display:flex; align-items:center; gap:.5rem}
.chips{display:flex; flex-wrap:wrap; gap:.35rem}
.chip{
  font-size:.75rem; line-height:1; padding:.35rem .5rem; border-radius:999px;
  background:#eef2fa; border:1px solid #d8dfeb; color:#0f172a; display:inline-flex; align-items:center; gap:.35rem;
}
.chip.locked{background:#fff0f0; border-color:#ffd6d6; color:#7a0c0c}
.chip.full{background:#fff8e1; border-color:#ffe6a5; color:#6b4d00}
.cards{
  padding:.5rem; display:flex; flex-direction:column; gap:.5rem; overflow:auto;
}
.card{
  background:var(--card); border:1px solid #e5e7eb; border-radius:10px; padding:.5rem .5rem;
  box-shadow:var(--shadow); display:flex; align-items:center; justify-content:space-between; gap:.5rem;
}
.card .name{font-weight:600}
.card-actions{display:flex; align-items:center; gap:.35rem}
.icon-btn{
  border:none; background:#eef2fa; color:#0f172a; border:1px solid #d8dfeb;
  padding:.35rem .5rem; border-radius:8px; cursor:pointer; font-weight:600; font-size:.85rem;
}
.icon-btn:focus-visible{outline:3px solid #1f7aff; outline-offset:2px}
.icon-btn.danger{background:#fff0f0; border-color:#ffd6d6; color:#7a0c0c}

.add-area{
  padding:.5rem .5rem .75rem; display:flex; gap:.35rem; border-top:1px dashed #d8dfeb; margin-top:auto; background:linear-gradient(180deg, #0000, #0000 55%, rgba(0,0,0,0.02));
}
.add-area input{
  flex:1; border:1px solid #cbd5e1; border-radius:8px; padding:.5rem .6rem; background:#fff; color:#111827;
}
.add-area input:focus-visible{outline:3px solid #1f7aff; outline-offset:2px}
.droptarget{
  outline:2px dashed #94a3b8; outline-offset:2px;
}

/* Toast for Undo */
.toast{
  position:fixed; left:50%; transform:translateX(-50%); bottom:16px; z-index:2000;
  background:var(--card); color:var(--text); border:1px solid #d8dfeb; border-radius:12px; box-shadow:var(--shadow);
  padding:.75rem 1rem; display:none; align-items:center; gap:.75rem;
  max-width:min(92vw, 720px);
}
.toast.show{display:flex}
.toast .timer{font-variant-numeric:tabular-nums; color:var(--muted)}

/* Right drawer */
.drawer-backdrop{position:fixed; inset:0; background:rgba(16,24,40,.4); display:none; align-items:stretch; z-index:1800}
.drawer-backdrop.open{display:flex}
.drawer{
  margin-left:auto; width:min(420px, 92vw); background:var(--card); height:100%;
  border-left:1px solid #d8dfeb; box-shadow:var(--shadow); display:flex; flex-direction:column;
}
.drawer header{padding:1rem; border-bottom:1px solid #e5e7eb; display:flex; justify-content:space-between; align-items:center}
.drawer .content{padding:1rem; display:flex; flex-direction:column; gap:.75rem; overflow:auto}
.field{display:flex; flex-direction:column; gap:.25rem}
.field label{font-weight:600}
.field input, .field textarea{
  border:1px solid #cbd5e1; border-radius:10px; padding:.6rem .7rem; background:#fff; color:#111827;
}
.fixed-profile-btn{
  position:fixed; right:16px; bottom:84px; z-index:1000;
}
.note{font-size:.9rem; color:var(--muted)}

/* About modal and Confirm dialog */
.modal-backdrop{position:fixed; inset:0; background:rgba(16,24,40,.4); display:none; align-items:center; justify-content:center; z-index:1700}
.modal-backdrop.open{display:flex}
.modal{
  width:min(560px, 92vw); background:var(--card); border:1px solid #d8dfeb; border-radius:12px; box-shadow:var(--shadow);
  display:flex; flex-direction:column; max-height:80vh;
}
.modal header{padding:1rem; border-bottom:1px solid #e5e7eb; display:flex; align-items:center; justify-content:space-between}
.modal .body{padding:1rem; overflow:auto}
.modal .footer{padding:1rem; border-top:1px solid #e5e7eb; display:flex; justify-content:flex-end; gap:.5rem}

/* Move popover */
.popover{
  position:absolute; z-index:1600; background:var(--card); border:1px solid #d8dfeb; border-radius:10px; box-shadow:var(--shadow);
  padding:.5rem; width:260px; display:none; flex-direction:column; gap:.35rem;
}
.popover.open{display:flex}
.popover h4{margin:.25rem .25rem .35rem; font-size:.95rem}
.dest-list{
  display:flex; align-items:center; justify-content:space-between; gap:.5rem;
  padding:.35rem; border-radius:8px; border:1px solid #e5e7eb; background:#f9fafb;
}
.dest-list[aria-disabled="true"]{opacity:.6}
.sr-only{
  position:absolute !important; width:1px !important; height:1px !important; padding:0 !important; margin:-1px !important; overflow:hidden !important; clip:rect(0,0,0,0) !important; white-space:nowrap !important; border:0 !important;
}

/* Mobile - lists become accordion sections */
@media (max-width: 720px){
  .board{flex-direction:column}
  .list{width:auto; min-width:0; max-height:none}
  .list-header{position:relative}
  .cards{display:none}
  .list.open .cards{display:flex}
  .add-area{display:none}
  .list.open .add-area{display:flex}
  .accordion-toggle{
    display:inline-flex; margin-left:auto; border:1px solid #cbd5e1; background:#fff; border-radius:8px; padding:.25rem .5rem; cursor:pointer; font-size:.85rem;
  }
  .accordion-toggle:focus-visible{outline:3px solid #1f7aff; outline-offset:2px}
}

</style> </head> <body> <header class="app-header" role="banner"> <div class="brand" aria-label="Volunteer signup board"> <span class="dot" aria-hidden="true"></span> <span>Volunteer Signups</span> </div> <div class="header-actions"> <button class="btn secondary" id="aboutBtn" aria-haspopup="dialog" aria-controls="aboutModal">About this board</button> </div> </header> <div class="board-wrap"> <div id="board" class="board" role="list" aria-label="Lists of volunteer roles"></div> </div> <!-- Fixed button to open profile drawer -->

<button class="btn fixed-profile-btn" id="openProfileBtn" aria-haspopup="dialog" aria-controls="profileDrawer">Add availability and skills</button>

<!-- Drawer --> <div id="drawerBackdrop" class="drawer-backdrop" aria-hidden="true"> <aside id="profileDrawer" class="drawer" role="dialog" aria-modal="true" aria-labelledby="drawerTitle"> <header> <h2 id="drawerTitle" style="margin:0">Your private info</h2> <button class="btn secondary" id="closeDrawerBtn">Close</button> </header> <div class="content"> <p class="note">Only admins can view this information. It will not appear on the public board.</p> <form id="profileForm"> <div class="field"> <label for="availability">Availability</label> <textarea id="availability" name="availability" rows="3" placeholder="Example: Sundays 8-12, not 10-27"></textarea> </div> <div class="field"> <label for="skills">Skills</label> <input id="skills" name="skills" placeholder="Example: greeter, usher, A-V, kids" /> </div> <div class="field"> <label for="email">Email</label> <input id="email" type="email" name="email" placeholder="you@example.org" /> </div> <div class="field"> <label for="phone">Phone</label> <input id="phone" type="tel" name="phone" placeholder="555-123-4567" /> </div> <div style="display:flex; gap:.5rem; margin-top:.5rem"> <button class="btn" type="submit">Save</button> <button class="btn secondary" type="button" id="cancelProfileBtn">Cancel</button> </div> </form> </div> </aside> </div> <!-- About modal --> <div id="aboutBackdrop" class="modal-backdrop" aria-hidden="true"> <section id="aboutModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="aboutTitle"> <header> <h2 id="aboutTitle" style="margin:0">About this board</h2> <button class="btn secondary" id="closeAboutBtn">Close</button> </header> <div class="body"> <ul> <li>This page is public. Anyone can add, remove, or move names on unlocked lists.</li> <li>Locked lists cannot be edited by the public.</li> <li>Use Undo in the toast to quickly reverse your last change within 10 seconds.</li> <li>Use the Add availability and skills button to share private info with admins only.</li> <li>All dynamic changes are announced for assistive technologies and everything is keyboard accessible.</li> </ul> </div> <div class="footer"> <button class="btn" id="okAboutBtn">OK</button> </div> </section> </div> <!-- Confirm dialog --> <div id="confirmBackdrop" class="modal-backdrop" aria-hidden="true"> <section id="confirmDialog" class="modal" role="dialog" aria-modal="true" aria-labelledby="confirmTitle" aria-describedby="confirmDesc"> <header> <h3 id="confirmTitle" style="margin:0">Confirm removal</h3> </header> <div class="body"> <p id="confirmDesc">Are you sure you want to remove this name from the list?</p> </div> <div class="footer"> <button class="btn secondary" id="confirmCancelBtn">Cancel</button> <button class="btn" id="confirmOkBtn">Remove</button> </div> </section> </div> <!-- Move popover (reused) --> <div id="movePopover" class="popover" role="dialog" aria-modal="true" aria-labelledby="moveTitle"> <h4 id="moveTitle">Move to list</h4> <div id="moveListContainer" style="display:flex; flex-direction:column; gap:.35rem"></div> <div style="display:flex; justify-content:flex-end; margin-top:.35rem"> <button class="btn secondary" id="closeMovePopoverBtn">Close</button> </div> </div> <!-- Announcements for screen readers --> <div id="announcer" class="sr-only" aria-live="polite" aria-atomic="true"></div> <!-- Toast --> <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"> <span id="toastMsg"></span> <span class="timer" id="toastTimer" aria-hidden="true"></span> <button class="btn secondary" id="undoBtn">Undo</button> </div> <script> ;(()=>{ /* ------------------ Data and persistence ------------------ */ const STORAGE_KEY = "volunteerBoardV1"; // Seed data - 3 dates, 6 roles, some locked, capacities const seedBoard = { version: 1, lists: [ list("2025-10-19", "Greeter", 3, false, ["Ava L", "Noah W"]), list("2025-10-19", "Usher", 2, false, ["Mia J"]), list("2025-10-26", "Greeter", 3, true, ["Ethan P", "Liam S"]), // locked list("2025-10-26", "Worship Team", 5, false, ["Chloe R"]), list("2025-11-02", "Kids", 4, false, ["Olivia T"]), list("2025-11-02", "Setup", 2, false, []) ] }; function list(date, role, capacity, locked, names){ return { id: uid("list"), date, role, capacity, locked, title: `${date} â€¢ ${role}`, cards: names.map(n => ({ id: uid("card"), name: n })) } } function loadBoard(){ // Wire backend here if needed // Example: return fetch('/api/board').then(...) const raw = localStorage.getItem(STORAGE_KEY); if(!raw) return structuredClone(seedBoard); try { return JSON.parse(raw); } catch { return structuredClone(seedBoard); } } function saveBoard(state){ // Wire backend here if needed // Example: await fetch('/api/board', { method:'POST', body: JSON.stringify(state) }) localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } function postProfile(payload){ // Wire backend here if needed // Example: await fetch('/api/profile', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) }) console.log("POST /api/profile", payload); } // Utilities function uid(prefix="id"){ return `${prefix}_${Math.random().toString(36).slice(2,7)}_${Date.now().toString(36)}` } const clone = obj => (typeof structuredClone === "function" ? structuredClone(obj) : JSON.parse(JSON.stringify(obj))); /* ------------------ State ------------------ */ let board = loadBoard(); let events = []; // { type, payload, timestamp } let pendingUndo = null; // { prevState, label, timerId, secondsLeft } // Focus memory to restore after rerender let focusAfterRender = null; /* ------------------ DOM refs ------------------ */ const boardEl = document.getElementById("board"); const announcer = document.getElementById("announcer"); const toast = document.getElementById("toast"); const toastMsg = document.getElementById("toastMsg"); const toastTimer = document.getElementById("toastTimer"); const undoBtn = document.getElementById("undoBtn"); const aboutBtn = document.getElementById("aboutBtn"); const aboutBackdrop = document.getElementById("aboutBackdrop"); const aboutModal = document.getElementById("aboutModal"); const closeAboutBtn = document.getElementById("closeAboutBtn"); const okAboutBtn = document.getElementById("okAboutBtn"); const drawerBackdrop = document.getElementById("drawerBackdrop"); const profileDrawer = document.getElementById("profileDrawer"); const openProfileBtn = document.getElementById("openProfileBtn"); const closeDrawerBtn = document.getElementById("closeDrawerBtn"); const cancelProfileBtn = document.getElementById("cancelProfileBtn"); const profileForm = document.getElementById("profileForm"); const confirmBackdrop = document.getElementById("confirmBackdrop"); const confirmDialog = document.getElementById("confirmDialog"); const confirmCancelBtn = document.getElementById("confirmCancelBtn"); const confirmOkBtn = document.getElementById("confirmOkBtn"); const movePopover = document.getElementById("movePopover"); const moveListContainer = document.getElementById("moveListContainer"); const closeMovePopoverBtn = document.getElementById("closeMovePopoverBtn"); /* ------------------ Rendering ------------------ */ function render(){ boardEl.innerHTML = ""; board.lists.forEach((list) => { boardEl.appendChild(renderList(list)); }); saveBoard(board); if(focusAfterRender){ const el = document.querySelector(`[data-focus-id="${focusAfterRender}"]`); if(el) el.focus(); focusAfterRender = null; } } function renderList(list){ const isFull = list.capacity != null && list.cards.length >= list.capacity; const el = document.createElement("section"); el.className = "list"; el.setAttribute("role","region"); el.setAttribute("aria-label", `${list.title}`); el.dataset.listId = list.id; // Header const header = document.createElement("div"); header.className = "list-header"; const title = document.createElement("div"); title.className = "list-title"; title.textContent = list.title; // Mobile accordion toggle const toggle = document.createElement("button"); toggle.className = "accordion-toggle"; toggle.type = "button"; toggle.textContent = "Toggle"; toggle.addEventListener("click", ()=>{ el.classList.toggle("open"); announce(`${list.title} ${el.classList.contains("open") ? "expanded" : "collapsed"}`); }); const chips = document.createElement("div"); chips.className = "chips"; const capText = list.capacity != null ? `${list.cards.length} of ${list.capacity}` : `${list.cards.length}`; const cap = chip(isFull ? "Full" : `Capacity ${capText}`, isFull ? "full" : ""); chips.appendChild(cap); if(list.locked){ chips.appendChild(chip("Locked", "locked")); } header.appendChild(title); header.appendChild(chips); header.appendChild(toggle); el.appendChild(header); // Cards container const cards = document.createElement("div"); cards.className = "cards"; cards.setAttribute("role","list"); cards.dataset.listId = list.id; cards.addEventListener("dragover", (e)=>{ if(list.locked) return; if(isFull) return; e.preventDefault(); cards.classList.add("droptarget"); }); cards.addEventListener("dragleave", ()=>cards.classList.remove("droptarget")); cards.addEventListener("drop", (e)=>{ cards.classList.remove("droptarget"); const cardId = e.dataTransfer.getData("text/plain"); const fromListId = e.dataTransfer.getData("from-list"); if(!cardId || !fromListId) return; if(list.locked) return; if(list.capacity != null && list.cards.length >= list.capacity) return; moveCard(cardId, fromListId, list.id); }); list.cards.forEach((card, idx)=>{ const cardEl = document.createElement("article"); cardEl.className = "card"; cardEl.setAttribute("role","listitem"); cardEl.dataset.cardId = card.id; cardEl.dataset.focusId = card.id; // Drag const canDrag = !list.locked; cardEl.setAttribute("draggable", canDrag ? "true" : "false"); if(canDrag){ cardEl.addEventListener("dragstart", (e)=>{ e.dataTransfer.setData("text/plain", card.id); e.dataTransfer.setData("from-list", list.id); e.dataTransfer.effectAllowed = "move"; }); } const name = document.createElement("div"); name.className = "name"; name.textContent = card.name; name.setAttribute("aria-label", `Volunteer ${card.name}`); const actions = document.createElement("div"); actions.className = "card-actions"; // Move button - keyboard alternative const moveBtn = document.createElement("button"); moveBtn.type = "button"; moveBtn.className = "icon-btn"; moveBtn.textContent = "Move"; moveBtn.setAttribute("aria-label", `Move ${card.name} to another list`); moveBtn.addEventListener("click", (ev)=>{ openMovePopover(ev.currentTarget, card.id, list.id); }); // Remove button const removeBtn = document.createElement("button"); removeBtn.type = "button"; removeBtn.className = "icon-btn danger"; removeBtn.textContent = "Remove"; removeBtn.setAttribute("aria-label", `Remove ${card.name}`); removeBtn.addEventListener("click", async ()=>{ const ok = await openConfirm(); if(!ok) return; removeCard(card.id, list.id); }); actions.appendChild(moveBtn); actions.appendChild(removeBtn); cardEl.appendChild(name); cardEl.appendChild(actions); cards.appendChild(cardEl); }); el.appendChild(cards); // Add area const addArea = document.createElement("div"); addArea.className = "add-area"; const input = document.createElement("input"); input.type = "text"; input.placeholder = "Your name"; input.setAttribute("aria-label", `Add name to ${list.title}`); const addBtn = document.createElement("button"); addBtn.type = "button"; addBtn.className = "btn"; addBtn.textContent = "Add"; if(list.locked || isFull){ input.disabled = true; addBtn.disabled = true; } addBtn.addEventListener("click", ()=>{ const value = input.value.trim(); if(!value) { input.focus(); return; } addNameToList(value, list.id); input.value = ""; }); input.addEventListener("keydown", (e)=>{ if(e.key === "Enter"){ addBtn.click(); } }); addArea.appendChild(input); addArea.appendChild(addBtn); el.appendChild(addArea); // Expand first list on mobile by default if(document.documentElement.clientWidth <= 720 && board.lists.indexOf(list) === 0){ el.classList.add("open"); } return el; } function chip(text, extraClass=""){ const span = document.createElement("span"); span.className = `chip ${extraClass}`.trim(); span.textContent = text; return span; } /* ------------------ Actions ------------------ */ function pushEvent(type, payload){ events.push({ type, payload, timestamp: Date.now() }); } function showUndo(label, prevState){ // Clear previous pending undo if any if(pendingUndo && pendingUndo.timerId) { clearInterval(pendingUndo.timerId); } let secondsLeft = 10; toastMsg.textContent = label; toastTimer.textContent = `(${secondsLeft}s)`; toast.classList.add("show"); pendingUndo = { prevState, label, timerId: null, secondsLeft }; pendingUndo.timerId = setInterval(()=>{ secondsLeft -= 1; pendingUndo.secondsLeft = secondsLeft; toastTimer.textContent = `(${Math.max(secondsLeft,0)}s)`; if(secondsLeft <= 0){ clearInterval(pendingUndo.timerId); toast.classList.remove("show"); toastMsg.textContent = ""; toastTimer.textContent = ""; pendingUndo = null; } }, 1000); } undoBtn.addEventListener("click", ()=>{ if(!pendingUndo) return; const prev = pendingUndo.prevState; clearInterval(pendingUndo.timerId); toast.classList.remove("show"); toastMsg.textContent = ""; toastTimer.textContent = ""; pendingUndo = null; board = clone(prev); announce("Undid the last change"); render(); }); function addNameToList(name, listId){ const prev = clone(board); const list = board.lists.find(l => l.id === listId); if(!list) return; if(list.locked) { announce("List is locked. Cannot add."); return; } if(list.capacity != null && list.cards.length >= list.capacity){ announce("List is full. Cannot add."); return; } list.cards.push({ id: uid("card"), name }); pushEvent("CardAdded", { name, listId }); announce(`Added ${name} to ${list.title}`); showUndo(`Added ${name}`, prev); render(); // After render, focus the newly added card const lastCard = list.cards[list.cards.length - 1]; focusAfterRender = lastCard.id; } function removeCard(cardId, listId){ const prev = clone(board); const list = board.lists.find(l => l.id === listId); if(!list) return; if(list.locked) { announce("List is locked. Cannot remove."); return; } const idx = list.cards.findIndex(c => c.id === cardId); if(idx === -1) return; const [removed] = list.cards.splice(idx, 1); pushEvent("CardRemoved", { name: removed.name, listId }); announce(`Removed ${removed.name} from ${list.title}`); showUndo(`Removed ${removed.name}`, prev); render(); // Focus the list title after removal focusAfterRender = list.id + "_title"; } function moveCard(cardId, fromListId, toListId){ if(fromListId === toListId) return; const prev = clone(board); const from = board.lists.find(l => l.id === fromListId); const to = board.lists.find(l => l.id === toListId); if(!from || !to) return; if(from.locked){ announce("Source list is locked. Cannot move."); return; } if(to.locked){ announce("Destination list is locked. Cannot move."); return; } if(to.capacity != null && to.cards.length >= to.capacity){ announce("Destination list is full. Cannot move."); return; } const idx = from.cards.findIndex(c => c.id === cardId); if(idx === -1) return; const [card] = from.cards.splice(idx, 1); to.cards.push(card); pushEvent("CardMoved", { name: card.name, fromListId, toListId }); announce(`Moved ${card.name} to ${to.title}`); showUndo(`Moved ${card.name}`, prev); render(); // After render, focus moved card focusAfterRender = card.id; } /* ------------------ Move popover ------------------ */ let currentPopoverContext = null; // { anchor, cardId, fromListId } function openMovePopover(anchorBtn, cardId, fromListId){ currentPopoverContext = { anchor: anchorBtn, cardId, fromListId }; moveListContainer.innerHTML = ""; board.lists.forEach(l=>{ const isSame = l.id === fromListId; const disabled = l.locked || (l.capacity != null && l.cards.length >= l.capacity); const row = document.createElement("div"); row.className = "dest-list"; row.setAttribute("role","group"); row.setAttribute("aria-label", l.title); if(disabled || isSame) row.setAttribute("aria-disabled","true"); const title = document.createElement("span"); title.textContent = l.title; const btn = document.createElement("button"); btn.type = "button"; btn.className = "icon-btn"; btn.textContent = "Move here"; btn.disabled = disabled || isSame; btn.addEventListener("click", ()=>{ closeMovePopover(); moveCard(cardId, fromListId, l.id); }); row.appendChild(title); row.appendChild(btn); moveListContainer.appendChild(row); }); const rect = anchorBtn.getBoundingClientRect(); const top = rect.bottom + window.scrollY + 8; const left = Math.min(rect.left + window.scrollX, window.innerWidth - 280); movePopover.style.top = `${top}px`; movePopover.style.left = `${left}px`; movePopover.classList.add("open"); trapFocusOpen(movePopover, ()=>closeMovePopover()); } function closeMovePopover(){ if(movePopover.classList.contains("open")){ movePopover.classList.remove("open"); trapFocusClose(movePopover); if(currentPopoverContext && currentPopoverContext.anchor){ currentPopoverContext.anchor.focus(); } currentPopoverContext = null; } } closeMovePopoverBtn.addEventListener("click", closeMovePopover); document.addEventListener("keydown", (e)=>{ if(e.key === "Escape"){ closeMovePopover(); } }); document.addEventListener("click", (e)=>{ if(!movePopover.classList.contains("open")) return; const within = movePopover.contains(e.target) || (currentPopoverContext && currentPopoverContext.anchor.contains(e.target)); if(!within) closeMovePopover(); }); /* ------------------ Confirm dialog ------------------ */ let confirmResolver = null; function openConfirm(){ return new Promise(resolve=>{ confirmResolver = resolve; confirmBackdrop.classList.add("open"); confirmBackdrop.removeAttribute("aria-hidden"); trapFocusOpen(confirmDialog, ()=>{ resolve(false); closeConfirm(); }); }); } function closeConfirm(){ confirmBackdrop.classList.remove("open"); confirmBackdrop.setAttribute("aria-hidden","true"); trapFocusClose(confirmDialog); } confirmCancelBtn.addEventListener("click", ()=>{ confirmResolver && confirmResolver(false); closeConfirm(); }); confirmOkBtn.addEventListener("click", ()=>{ confirmResolver && confirmResolver(true); closeConfirm(); }); document.addEventListener("keydown", (e)=>{ if(confirmBackdrop.classList.contains("open") && e.key === "Escape"){ confirmResolver && confirmResolver(false); closeConfirm(); } }); /* ------------------ About modal ------------------ */ aboutBtn.addEventListener("click", ()=>{ aboutBackdrop.classList.add("open"); aboutBackdrop.removeAttribute("aria-hidden"); trapFocusOpen(aboutModal, ()=>closeAbout()); }); function closeAbout(){ aboutBackdrop.classList.remove("open"); aboutBackdrop.setAttribute("aria-hidden","true"); trapFocusClose(aboutModal); aboutBtn.focus(); } closeAboutBtn.addEventListener("click", closeAbout); okAboutBtn.addEventListener("click", closeAbout); document.addEventListener("keydown", (e)=>{ if(aboutBackdrop.classList.contains("open") && e.key === "Escape"){ closeAbout(); } }); /* ------------------ Drawer ------------------ */ openProfileBtn.addEventListener("click", ()=>{ drawerBackdrop.classList.add("open"); drawerBackdrop.removeAttribute("aria-hidden"); trapFocusOpen(profileDrawer, ()=>closeDrawer()); }); function closeDrawer(){ drawerBackdrop.classList.remove("open"); drawerBackdrop.setAttribute("aria-hidden","true"); trapFocusClose(profileDrawer); openProfileBtn.focus(); } closeDrawerBtn.addEventListener("click", closeDrawer); cancelProfileBtn.addEventListener("click", closeDrawer); document.addEventListener("keydown", (e)=>{ if(drawerBackdrop.classList.contains("open") && e.key === "Escape"){ closeDrawer(); } }); profileForm.addEventListener("submit", (e)=>{ e.preventDefault(); const formData = new FormData(profileForm); const payload = Object.fromEntries(formData.entries()); postProfile({ ...payload, timestamp: new Date().toISOString() }); closeDrawer(); announce("Profile info submitted"); const prev = clone(board); // No board change, but we still allow the toast feedback showUndo("Saved profile info", prev); }); /* ------------------ Focus trap helpers ------------------ */ const focusMemory = new WeakMap(); function focusables(root){ return Array.from(root.querySelectorAll(` a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"]) `)).filter(el => !el.hasAttribute("disabled") && !el.getAttribute("aria-disabled")); } function trapFocusOpen(container, onClose){ // Remember previously focused element focusMemory.set(container, document.activeElement); const items = focusables(container); if(items[0]) items[0].focus(); container._trapHandler = (e)=>{ if(e.key !== "Tab") return; const nodes = focusables(container); if(nodes.length === 0) return; const first = nodes[0]; const last = nodes[nodes.length - 1]; if(e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); } else if(!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); } }; container.addEventListener("keydown", container._trapHandler); container._onClose = onClose; } function trapFocusClose(container){ if(container._trapHandler) container.removeEventListener("keydown", container._trapHandler); const prev = focusMemory.get(container); if(prev && typeof prev.focus === "function") prev.focus(); focusMemory.delete(container); } /* ------------------ Helpers ------------------ */ function announce(msg){ announcer.textContent = msg; } /* ------------------ Init ------------------ */ render(); })(); </script> </body> </html> ::contentReference[oaicite:0]{index=0}